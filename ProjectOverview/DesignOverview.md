# 游戏设计概览.md

> 项目代号：OpenCode Buddy（可改名）
> 版本：v0.1（MVP）
> 最后更新：2026-02-05
> 核心定位：把 OpenCode 的“todo/对话进度”转译成一个低打扰、可挂机、可成长的像素战斗桌面挂件

---

## 1. 设计目标与原则

### 1.1 核心目标（只盯住这一个）
- **进度可视化**：用户不需要盯着终端或日志，也能感知“当前是否在工作、还有多少 todo 未完成、是否已完成一轮对话”。
- **正反馈与成长感**：通过“完成 todo / 完成对话”触发奖励（新增剑士），带来持续的新鲜感与积累感。

### 1.2 体验原则（避免分心）
- **默认零操作**：挂机为主；最多提供托盘菜单/快捷键：显示/隐藏、暂停动画、置顶、静音、透明度。
- **不依赖对话文本语义**：默认不读取/不展示用户 prompt 与 AI 输出内容，只使用计数与状态（隐私优先）。
- **惊喜靠演出而非操作**：特殊攻击、稀有敌人、处决/庆祝演出等，采用低频随机触发。
- **反馈必须可信**：进度主要由 todo 状态驱动，而非“输出字数”或“看起来很忙”。

---

## 2. MVP 范围（本次收敛）

### 2.1 MVP 必做
1) 剑士 vs 敌人（像素 2D 帧动画）
2) 波次敌人刷新（未完成 todo 时无限刷新）
3) todo/对话统计 → 任务系统 → 奖励“新增剑士”
4) 剑士特殊攻击概率（暴击/连击演出）
5) 剑士闲置动作（idle）与“工作低频动作”（busy 时偶发）
6) 敌人概率池（不同敌人按权重生成）

### 2.2 MVP 不做（明确边界）
- 职业变化、装备系统、技能树
- 复杂 UI（背包、任务面板大页）
- 强制通知/弹窗打断（默认关闭）
- 把对话内容映射成怪物种类（隐私与复杂度都不值得）

---

## 3. 进度到战斗的映射（核心机制）

### 3.1 工作状态输入（来自 OpenCode）
- busy/idle：用于调节战斗节奏（忙 → 打得更快；闲 → 防御/待机更多）
- todo 列表：用于决定“敌人压力”（未完成数量）与“完成反馈”（处决/庆祝）
- 对话完成：用于任务统计与长期成长

### 3.2 战斗状态机（MVP）
- Dormant：未检测到会话/未启动
- SessionStart：会话开始，入场演出，初始化敌群
- Combat：存在未完成 todo → 敌人持续生成 → 战斗循环
- ResolveTodo：检测到 todo 完成 → 短暂处决/清场演出 → 回到 Combat 或 Victory
- Victory：所有 todo 完成或会话结束 → 全员庆祝 → 回到 Dormant/等待下一会话

---

## 4. 敌人刷新（波次）与压力曲线

### 4.1 关键变量
- openTodos：未完成 todo 数
- totalTodos：本轮 todo 总数（用于难度微调）
- aliveTarget：场上目标敌人数（越多越“压力可视化”）

### 4.2 生成规则（建议默认值，可配置）
- aliveTarget = baseAlive + openTodos * alivePerTodo
  - baseAlive=2
  - alivePerTodo=1
- 刷新延迟：respawnDelay ∈ [0.8s, 1.6s]（均匀随机）
- 未完成 todo 时：敌人死亡后仍可继续刷新，直到 openTodos 归零
- openTodos 变小：aliveTarget 下降，视觉压力明显降低

### 4.3 敌人概率池（MVP）
- 敌人按“池”抽取：tier1 池（史莱姆/蝙蝠/骷髅等）
- 权重示例：
  - 普通 80%
  - 精英 18%（同种换色/更大体型/更高 HP）
  - 稀有 2%（只做视觉与更长处决演出，不做复杂机制）

---

## 5. 剑士行为：挂机但有节奏

### 5.1 动作集合（MVP）
- idle：循环待机
- attack：常规攻击
- defend：格挡/防御（降低受击伤害 + 演出）
- special：特殊攻击（暴击/连击/范围斩）— 低概率触发
- work：工作动作（busy 时低频触发，如“翻笔记/敲键盘/磨刀”）

### 5.2 忙/闲对动作权重的影响
- Busy（AI 在生成/工具执行中）：
  - attack 权重 ↑
  - work 低频触发开启
- Idle（AI 等待用户输入）：
  - idle/defend 权重 ↑
  - attack 降低，避免“看起来还在推进”造成误导

### 5.3 特殊攻击（惊喜核心）
- 每次可攻击时独立掷骰：
  - specialChance = 8%（可配置）
- special 触发：
  - 播放 special 动画
  - 伤害倍率（如 x2.5）或追加一次打击
  - 可选：暴击飘字/斩击弧光特效（小且克制）

---

## 6. todo 完成的“处决/清场”反馈

当检测到 todo 从未完成→完成：
1) 暂停刷新（停止新增敌人）
2) 进入 ResolveTodo：
   - 快速斩杀场上剩余敌人（处决演出）
   - 1~2 秒内结束，给用户明确“推进了”的信号
3) 若仍有 openTodos：回到 Combat（下一压力阶段）
4) 若 openTodos=0：进入 Victory

---

## 7. 任务系统与奖励（只做“新增剑士”）

### 7.1 任务类型（被动统计）
- Todo 任务：累计完成 todo 达到阈值 → 奖励 1 名新剑士
- 对话任务：累计完成对话（本轮 todo 清零且进入 idle/结束）达到阈值 → 奖励 1 名新剑士

### 7.2 奖励机制
- 新增剑士直接加入队伍（队伍人数上限可配置，例如 6）
- 剑士外观可相同（最省素材）或从“剑士皮肤池”中随机抽取（可选）
- 奖励演出：短暂“新成员入场”动画（1s 内），不打断工作

---

## 8. 美术与素材需求（MVP）

### 8.1 剑士（至少 1 套）
- 帧动画 PNG 序列（透明背景）：
  - idle（循环，建议 6 帧）
  - attack（6~8 帧）
  - defend（3~5 帧）
  - special（6~10 帧；可与 attack 复用但建议有差异）
  - work（4~6 帧；可缺省，缺省则复用 idle）
- 尺寸建议统一：32×32 或 48×48（随素材而定，但全项目统一）
- 统一朝向（默认面向右或左，项目内一致）

### 8.2 敌人（至少 1 种，建议 2~3 种）
- 帧动画 PNG 序列：
  - idle（循环）
  - attack
  - hit（可缺省：用闪白替代）
  - die（死亡）

### 8.3 UI/特效（可选但推荐）
- 暴击飘字（文本即可）
- 斩击弧光（2~4 帧）
- 简单粒子（像素方块飞散）

---

## 9. UI/交互（低打扰）

- 托盘菜单（Tray）：
  - 显示/隐藏
  - 暂停/继续动画
  - 置顶
  - 静音
  - 透明度（0~100）
  - 退出
- 窗口默认：
  - 小尺寸（例如 360×220，可配置）
  - 无边框
  - 可拖拽
  - 默认不抢焦点（尽量不打断输入）

---

## 10. 验收标准（MVP Definition of Done）
1) 启动 opencode 后（存在插件）桌面挂件能自动进入 SessionStart/Combat
2) todo 未完成时，敌人会持续刷新，战斗循环稳定
3) 完成一个 todo 时能触发 ResolveTodo 的清场演出
4) 全部 todo 完成或会话结束时进入 Victory 并庆祝
5) 任务阈值达成后新增剑士，队伍人数变化可见
6) 新增剑士/敌人可通过“放素材+写配置”完成，无需改代码
